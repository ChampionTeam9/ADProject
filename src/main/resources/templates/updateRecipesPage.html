<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Recipe</title>
    <style>
        /* 样式部分保持不变 */
    </style>
</head>
<body>
    <h2>Update Recipe</h2>
    <form action="/recipe/edit" method="post">
		<input type="hidden" id="idInput" name="id" th:value="${recipe.id}">
        <label for="nameInput">Recipe Name:</label>
        <input type="text" id="nameInput" name="name" required th:value="${recipe.name}"> 
        <br>
      
        <label for="descriptionInput">Description:</label>
        <input type="text" id="descriptionInput" name="description" required th:value="${recipe.description}">      
        <br>
        
        <label for="servingsInput">Servings:</label>
        <input type="number" id="servingsInput" name="servings" required min="1" step="1" th:value="${recipe.servings}">
        <!-- min="1" 表示最小值为1，step="1" 表示步长为1，即只能输入整数 -->
        <br>
        
        <label for="preparationTimeInput">Preparation Time:</label>
        <input type="number" id="preparationTimeInput" name="preparationTime" required min="1" step="1" th:value="${recipe.preparationTime}">
        
        <!-- 添加按钮或下拉列表来选择时间单位 -->
        <label for="timeUnit">Time Unit:</label>
        <select id="timeUnit" name="timeUnit">
            <option value="minutes">Minutes</option>
            <option value="hours">Hours</option>
        </select>
        <br>
        
        <label for="ingredientsInput">Ingredients:</label>
        <div id="ingredientsContainer">
            <div th:each="ingredient, status : ${recipe.ingredients}">
        	<input type="text" name="ingredients" th:value="${ingredient}">
        	<button type="button" th:attr="onclick='deleteIngredient(\'' + ${status.index} + '\')'">Delete</button>

        	<br>
    		</div>
		    
        </div>

        <!-- 按钮触发添加新原料框 -->
        <button type="button" onclick="addIngredient()">Add Ingredient</button>
        <br>
        
        <label for="stepsInput">steps:</label>
        <div id="stepsContainer">
            <div th:each="step, status : ${recipe.steps}">
        	<input type="text" name="steps" th:value="${step}">
        	<button type="button" th:attr="onclick='deleteStep(\'' + ${status.index} + '\')'">Delete</button>
        	<br>
    		</div>

    		
        </div>

        <!-- 按钮触发添加新指引框 -->
        <button type="button" onclick="addstep()">Add step</button>
        <br>
        
        
        <!-- Upload Picture 输入框 -->
        <label for="pictureInput">Upload Picture:</label>
        <input type="file" id="pictureInput" name="image" accept="image/*" style="display: none;" class="fileBtn" onchange="selectFromFile()">
        

        <!-- 图片预览框 -->
        <div id="picturePreview"></div>
        
        <button type="button" onclick="selectFromFile()">Select Picture</button>
		<br>
        
        
       
        
        <!-- Tags 输入框 --> 
        <label for="tagsInput">Tags:</label>
        <div id="tagsContainer">
            <div th:each="tag, status : ${recipe.tags}">
        	<input type="text" name="tags" th:value="${tag}">
        	<button type="button" th:attr="onclick='deleteTag(\'' + ${status.index} + '\')'">Delete</button>

        	<br>
    		</div>
		   
        </div>
        
        <!-- 按钮触发添加新指引框 -->
        <button type="button" onclick="addTags()">Add tag</button>
        <br>
        
        
        <label for="public">Public</label>
    	<input type="radio" id="public" name="status" value="Public" th:checked="${recipe.status == 'Public'}">

    	<label for="private">Private</label>
    	<input type="radio" id="private" name="status" value="Private" th:checked="${recipe.status == 'Private'}">

    	
		<br>
    
        <button type="submit">Update Recipe</button>
        
    </form>
    
    <script>
        function addIngredient() {
        var container = document.getElementById("ingredientsContainer");
        var input = document.createElement("input");
        input.type = "text";
        input.name = "ingredients";
        input.required = true;
        
        // 创建删除按钮
        var deleteButton = document.createElement("button");
        deleteButton.type = "button";
        deleteButton.textContent = "Delete";
        // 使用匿名函数绑定点击事件，传递当前元素（行）的引索
        deleteButton.onclick = function() {
            deleteRow(this.parentNode);
        };

        container.appendChild(input);
        container.appendChild(deleteButton);
        container.appendChild(document.createElement("br"));
    }

        function deleteIngredient(index) {
        var container = document.getElementById("ingredientsContainer");
        var rows = container.getElementsByTagName("div");
        
        if (index >= 0 && index <= rows.length) {
            container.removeChild(rows[index]);
        }
    }
        
        
        function addstep() {
            var container = document.getElementById("stepsContainer");
            var input = document.createElement("input");
            input.type = "text";
            input.name = "steps";
            input.required = true;
            
            // 创建删除按钮
	        var deleteButton = document.createElement("button");
	        deleteButton.type = "button";
	        deleteButton.textContent = "Delete";
	        // 使用匿名函数绑定点击事件，传递当前元素（行）的引索
	        deleteButton.onclick = function() {
            deleteRow(this.parentNode);
        };
        
            container.appendChild(input);
            container.appendChild(deleteButton);
            container.appendChild(document.createElement("br"));
        }
        
        function deleteStep(index) {
        var container = document.getElementById("stepsContainer");
        var rows = container.getElementsByTagName("div");
        
        if (index >= 0 && index <= rows.length) {
            container.removeChild(rows[index]);
        }
    }
         function addTag() {
            var container = document.getElementById("tagsContainer");
            var input = document.createElement("input");
            input.type = "text";
            input.name = "tags";
            input.required = true;
            
            // 创建删除按钮
	        var deleteButton = document.createElement("button");
	        deleteButton.type = "button";
	        deleteButton.textContent = "Delete";
	        // 使用匿名函数绑定点击事件，传递当前元素（行）的引索
	        deleteButton.onclick = function() {
            deleteRow(this.parentNode);
        };
        
            container.appendChild(input);
            container.appendChild(deleteButton);
            container.appendChild(document.createElement("br"));
        }
        
        function deleteTag(index) {
        var container = document.getElementById("tagsContainer");
        var rows = container.getElementsByTagName("div");
        
        if (index >= 0 && index <= rows.length) {
            container.removeChild(rows[index]);
        }
    }
    
        function selectFromFile() {
            document.getElementById("pictureInput").click();
		}

		// 当文件选择框内容改变时触发
		document.getElementById("pictureInput").addEventListener("change", function() {
    		uploadAndPreview();
		});

		function uploadAndPreview() {
		    var pictureInput = document.getElementById("pictureInput");
		    var picturePreview = document.getElementById("picturePreview");
		
		    // 清空图片预览框
		    picturePreview.innerHTML = "";
		
		    // 获取用户选择的文件
		    var file = pictureInput.files[0];
		
		    // 创建一个 FileReader 对象
		    var reader = new FileReader();
		
		    // 设置文件加载完成后的回调函数
		    reader.onload = function (e) {
		        // 创建一个 <img> 元素用于显示预览图片
		        var img = document.createElement("img");
		        img.src = e.target.result;
		        img.style.maxWidth = "300px";  // 设置图片最大宽度
		        img.style.maxHeight = "300px"; // 设置图片最大高度
		        picturePreview.appendChild(img);  // 将图片添加到预览框里面
		    };
		
		    // 读取文件内容
		    reader.readAsDataURL(file);
		        }
		        
	    var recipeStatus = /*[[${recipe.status}]]*/ 'unknown';
	    console.log("Recipe Status:", recipeStatus);
	
    </script>
</body>
</html>
